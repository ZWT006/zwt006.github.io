<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en' }}" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="{{ page.description | default: page.excerpt | strip_html | normalize_whitespace | truncate: 200 | escape }}">
  <title>{{ page.title }} | {{ site.title }}</title>

  <!-- Apply saved theme immediately to avoid flash -->
  <script>
    (function () {
      var saved = localStorage.getItem('ac-theme');
      var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      var theme = saved || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>

  <!-- Bootstrap CSS (CDN) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <!-- FontAwesome (CDN) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">

  <style>
    /* ────────────────────────────────────────────────
       Light theme (default)
    ──────────────────────────────────────────────── */
    :root,
    [data-theme="light"] {
      --accent:        {{ page.btn_color | default: "#2c3e50" }};
      --link:          #2980b9;
      --muted:         #6c757d;
      --border:        #dee2e6;
      --bg:            #ffffff;
      --code-bg:       #f8f9fa;
      --text:          #333333;
      --text-sub:      #555555;
      --navbar-bg:     rgba(255,255,255,0.95);
      --hero-bg:       linear-gradient(to bottom, #f7f9fc, #ffffff);
      --footer-bg:     #f8f9fa;
      --table-stripe:  #f8f9fa;
      --venue-bg:      #e8f4fd;
      --venue-color:   #1565c0;
      --venue-border:  #90caf9;
      --quote-bg:      #f0f7ff;
      --quote-border:  #90caf9;
      --quote-color:   #1a5276;
    }

    /* ────────────────────────────────────────────────
       Dark theme
    ──────────────────────────────────────────────── */
    [data-theme="dark"] {
      --accent:        {{ page.btn_color | default: "#4a7fa5" }};
      --link:          #5dade2;
      --muted:         #8b949e;
      --border:        #30363d;
      --bg:            #0d1117;
      --code-bg:       #161b22;
      --text:          #e6edf3;
      --text-sub:      #b0bec5;
      --navbar-bg:     rgba(13,17,23,0.96);
      --hero-bg:       linear-gradient(to bottom, #161b22, #0d1117);
      --footer-bg:     #161b22;
      --table-stripe:  #161b22;
      --venue-bg:      #1c2333;
      --venue-color:   #90caf9;
      --venue-border:  #30363d;
      --quote-bg:      #1c2333;
      --quote-border:  #4a7fa5;
      --quote-color:   #90caf9;
    }

    /* ────────────────────────────────────────────────
       Base
    ──────────────────────────────────────────────── */
    * { box-sizing: border-box; }

    html { transition: background 0.2s, color 0.2s; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                   "Helvetica Neue", Arial, sans-serif;
      font-size: 1.05rem;
      line-height: 1.75;
      color: var(--text);
      background: var(--bg);
      transition: background 0.2s, color 0.2s;
    }

    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* ────────────────────────────────────────────────
       Navbar
    ──────────────────────────────────────────────── */
    .ac-navbar {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--navbar-bg);
      backdrop-filter: blur(6px);
      border-bottom: 1px solid var(--border);
      padding: 0.6rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .ac-navbar .site-name {
      font-weight: 600;
      color: var(--accent);
      font-size: 1rem;
    }
    .ac-navbar .nav-links {
      display: flex;
      align-items: center;
    }
    .ac-navbar .nav-links a {
      margin-left: 1.2rem;
      font-size: 0.9rem;
      color: var(--muted);
    }
    .ac-navbar .nav-links a:hover { color: var(--accent); text-decoration: none; }

    /* Theme toggle button */
    .theme-toggle {
      background: none;
      border: 1px solid var(--border);
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      color: var(--muted);
      padding: 0.25rem 0.55rem;
      margin-left: 1rem;
      transition: color 0.15s, border-color 0.15s, background 0.15s;
      line-height: 1;
    }
    .theme-toggle:hover {
      color: var(--accent);
      border-color: var(--accent);
      background: var(--code-bg);
    }

    /* ────────────────────────────────────────────────
       Hero / Title
    ──────────────────────────────────────────────── */
    .ac-hero {
      text-align: center;
      padding: 3.5rem 1.5rem 2rem;
      background: var(--hero-bg);
      border-bottom: 1px solid var(--border);
    }
    .ac-hero h1 {
      font-size: clamp(1.5rem, 4vw, 2.4rem);
      font-weight: 700;
      color: var(--accent);
      line-height: 1.3;
      max-width: 820px;
      margin: 0 auto 1rem;
    }
    .ac-venue {
      display: inline-block;
      background: var(--venue-bg);
      color: var(--venue-color);
      border: 1px solid var(--venue-border);
      border-radius: 4px;
      padding: 0.15rem 0.75rem;
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 1.2rem;
    }
    .ac-authors {
      font-size: 1.05rem;
      color: var(--text);
      max-width: 720px;
      margin: 0 auto 0.5rem;
    }
    .ac-authors a { color: var(--link); }
    .ac-affiliations {
      font-size: 0.9rem;
      color: var(--muted);
      max-width: 680px;
      margin: 0 auto 1.5rem;
    }

    /* ────────────────────────────────────────────────
       Link Buttons — unified single color
    ──────────────────────────────────────────────── */
    .ac-links {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      justify-content: center;
      margin-top: 1rem;
    }
    .ac-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.45rem 1.2rem;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 500;
      border: 1.5px solid var(--accent);
      background: var(--accent);
      color: #fff;
      transition: opacity 0.15s, transform 0.1s;
      cursor: pointer;
    }
    .ac-btn:hover {
      opacity: 0.85;
      color: #fff;
      text-decoration: none;
      transform: translateY(-1px);
    }
    .ac-btn-outline {
      background: transparent;
      color: var(--accent);
    }
    .ac-btn-outline:hover {
      background: var(--accent);
      color: #fff;
    }

    /* ────────────────────────────────────────────────
       Teaser image / video
    ──────────────────────────────────────────────── */
    .ac-teaser {
      max-width: 960px;
      margin: 2rem auto;
      padding: 0 1.5rem;
      text-align: center;
    }
    .ac-teaser img {
      width: 100%;
      border-radius: 8px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.12);
    }
    .ac-teaser figcaption {
      margin-top: 0.6rem;
      font-size: 0.88rem;
      color: var(--muted);
    }

    /* ────────────────────────────────────────────────
       Responsive video wrapper (teaser + inline)
    ──────────────────────────────────────────────── */
    .video-wrapper {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 10px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.18);
    }
    .video-wrapper iframe,
    .video-wrapper video {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      border: 0;
    }

    /* ────────────────────────────────────────────────
       Main content wrapper
    ──────────────────────────────────────────────── */
    .ac-content {
      max-width: 860px;
      margin: 0 auto;
      padding: 2rem 1.5rem 4rem;
    }

    /* Headings */
    .ac-content h2 {
      font-size: 1.55rem;
      font-weight: 700;
      color: var(--accent);
      margin-top: 2.8rem;
      margin-bottom: 0.8rem;
      padding-bottom: 0.35rem;
      border-bottom: 2px solid var(--border);
    }
    .ac-content h3 {
      font-size: 1.18rem;
      font-weight: 600;
      color: var(--text-sub);
      margin-top: 1.8rem;
      margin-bottom: 0.5rem;
    }
    .ac-content h4 {
      font-size: 1.02rem;
      font-weight: 600;
      margin-top: 1.4rem;
    }

    /* Images */
    .ac-content img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 1.2rem auto;
      border-radius: 6px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.12);
    }

    /* In-content video wrappers */
    .ac-content .video-wrapper { margin: 1.5rem 0; }

    /* Code blocks */
    .ac-content pre {
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1rem 1.2rem;
      overflow-x: auto;
      font-size: 0.88rem;
      color: var(--text);
    }
    .ac-content code {
      background: var(--code-bg);
      color: var(--text);
      border-radius: 3px;
      padding: 0.15em 0.4em;
      font-size: 0.9em;
    }
    .ac-content pre code { background: transparent; padding: 0; }

    /* Blockquotes */
    .ac-content blockquote {
      border-left: 4px solid var(--quote-border);
      background: var(--quote-bg);
      padding: 0.8rem 1rem;
      margin: 1.2rem 0;
      border-radius: 0 6px 6px 0;
      color: var(--quote-color);
    }

    /* Tables */
    .ac-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.2rem 0;
      font-size: 0.95rem;
    }
    .ac-content th {
      background: var(--accent);
      color: #fff;
      padding: 0.5rem 0.8rem;
      text-align: left;
    }
    .ac-content td {
      padding: 0.45rem 0.8rem;
      border-bottom: 1px solid var(--border);
    }
    .ac-content tr:nth-child(even) td { background: var(--table-stripe); }
    .ac-content td.best { font-weight: 700; color: #1a8a4a; }

    /* HR */
    .ac-content hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 2.2rem 0;
    }

    /* ────────────────────────────────────────────────
       BibTeX section
    ──────────────────────────────────────────────── */
    .ac-bibtex-section {
      max-width: 860px;
      margin: 0 auto 3rem;
      padding: 0 1.5rem;
    }
    .ac-bibtex-section h2 {
      font-size: 1.55rem;
      font-weight: 700;
      color: var(--accent);
      padding-bottom: 0.35rem;
      border-bottom: 2px solid var(--border);
      margin-bottom: 1rem;
    }
    .bibtex-block {
      background: var(--code-bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-left: 4px solid var(--accent);
      border-radius: 6px;
      padding: 1rem 1.2rem;
      font-family: "SFMono-Regular", Consolas, monospace;
      font-size: 0.85rem;
      overflow-x: auto;
      white-space: pre;
    }

    /* ────────────────────────────────────────────────
       Footer
    ──────────────────────────────────────────────── */
    .ac-footer {
      text-align: center;
      padding: 1.5rem;
      border-top: 1px solid var(--border);
      font-size: 0.88rem;
      color: var(--muted);
      background: var(--footer-bg);
    }
    .ac-footer a { color: var(--muted); }
    .ac-footer a:hover { color: var(--accent); }

    /* ────────────────────────────────────────────────
       Responsive
    ──────────────────────────────────────────────── */
    @media (max-width: 576px) {
      .ac-hero    { padding: 2rem 1rem 1.5rem; }
      .ac-content { padding: 1.5rem 1rem 3rem; }
    }
  </style>

  {% if page.math %}
  <script>
    MathJax = { tex: { inlineMath: [['$','$'],['\\(','\\)']] }, svg: { fontCache: 'global' } };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js" async></script>
  {% endif %}
</head>

<body>

  <!-- ═══════════════ Navbar ═══════════════ -->
  <nav class="ac-navbar">
    <a class="site-name" href="{{ '/' | relative_url }}">
      <i class="fas fa-home me-1"></i>{{ site.title }}
    </a>
    <div class="nav-links">
      {% if site.tabs %}
        {% for tab in site.tabs %}
          <a href="{{ tab.url | relative_url }}">{{ tab.title }}</a>
        {% endfor %}
      {% endif %}
      <!-- Dark / Light toggle -->
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark/light mode" title="Toggle dark/light mode">
        <i class="fas fa-moon" id="theme-icon"></i>
      </button>
    </div>
  </nav>

  <!-- ═══════════════ Hero ═══════════════ -->
  <header class="ac-hero">

    {% if page.venue %}
    <div class="ac-venue">{{ page.venue }}</div>
    {% endif %}

    <h1>{{ page.title }}</h1>

    {% if page.authors %}
    <p class="ac-authors">{{ page.authors }}</p>
    {% endif %}

    {% if page.affiliations %}
    <p class="ac-affiliations">{{ page.affiliations }}</p>
    {% endif %}

    <!-- Unified action buttons -->
    <div class="ac-links">
      {% if page.paper_url %}
      <a class="ac-btn" href="{{ page.paper_url }}" target="_blank" rel="noopener">
        <i class="fas fa-file-pdf"></i> Paper
      </a>
      {% endif %}
      {% if page.arxiv_url %}
      <a class="ac-btn" href="{{ page.arxiv_url }}" target="_blank" rel="noopener">
        <i class="ai ai-arxiv"></i> arXiv
      </a>
      {% endif %}
      {% if page.video_url %}
      <a class="ac-btn" href="{{ page.video_url }}" target="_blank" rel="noopener">
        <i class="fab fa-youtube"></i> Video
      </a>
      {% endif %}
      {% if page.summary_url %}
      <a class="ac-btn" href="{{ page.summary_url }}" target="_blank" rel="noopener">
        <i class="fas fa-film"></i> Summary
      </a>
      {% endif %}
      {% if page.code_url %}
      <a class="ac-btn" href="{{ page.code_url }}" target="_blank" rel="noopener">
        <i class="fab fa-github"></i> Code
      </a>
      {% endif %}
      {% if page.poster_url %}
      <a class="ac-btn ac-btn-outline" href="{{ page.poster_url }}" target="_blank" rel="noopener">
        <i class="fas fa-image"></i> Poster
      </a>
      {% endif %}
      {% if page.slides_url %}
      <a class="ac-btn ac-btn-outline" href="{{ page.slides_url }}" target="_blank" rel="noopener">
        <i class="fas fa-tv"></i> Slides
      </a>
      {% endif %}
      {% if page.data_url %}
      <a class="ac-btn ac-btn-outline" href="{{ page.data_url }}" target="_blank" rel="noopener">
        <i class="fas fa-database"></i> Dataset
      </a>
      {% endif %}
    </div>

  </header>

  <!-- ═══════════════ Teaser: image ═══════════════ -->
  {% if page.teaser_image %}
  <div class="ac-teaser">
    <figure>
      <img src="{{ page.teaser_image | relative_url }}" alt="{{ page.teaser_caption | default: page.title }}">
      {% if page.teaser_caption %}
      <figcaption>{{ page.teaser_caption }}</figcaption>
      {% endif %}
    </figure>
  </div>
  {% endif %}

  <!-- ═══════════════ Teaser: YouTube video ═══════════════ -->
  {% if page.youtube_url %}
  <div class="ac-teaser">
    <figure>
      <div class="video-wrapper">
        <iframe
          src="{{ page.youtube_url | replace: 'youtu.be/', 'www.youtube.com/embed/' | replace: 'watch?v=', 'embed/' }}"
          title="{{ page.title }}"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen>
        </iframe>
      </div>
      {% if page.teaser_caption %}
      <figcaption>{{ page.teaser_caption }}</figcaption>
      {% endif %}
    </figure>
  </div>
  {% endif %}

  <!-- ═══════════════ Main Content ═══════════════ -->
  <main class="ac-content">
    {{ content }}
  </main>

  <!-- ═══════════════ BibTeX ═══════════════ -->
  {% if page.bibtex %}
  <div class="ac-bibtex-section">
    <h2>BibTeX</h2>
    <pre class="bibtex-block">{{ page.bibtex }}</pre>
  </div>
  {% endif %}

  <!-- ═══════════════ Footer ═══════════════ -->
  <footer class="ac-footer">
    <p>
      © {{ site.time | date: '%Y' }}
      <a href="{{ '/' | relative_url }}">{{ site.social.name | default: site.title }}</a>
      &nbsp;·&nbsp;
      <a href="{{ '/' | relative_url }}"><i class="fas fa-home"></i> Back to Home</a>
    </p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Theme toggle logic -->
  <script>
    (function () {
      var icon   = document.getElementById('theme-icon');
      var toggle = document.getElementById('theme-toggle');

      function getTheme() {
        return document.documentElement.getAttribute('data-theme') || 'light';
      }

      function setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('ac-theme', theme);
        icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
      }

      // Sync icon with current theme on load
      setTheme(getTheme());

      // Toggle on click
      toggle.addEventListener('click', function () {
        setTheme(getTheme() === 'dark' ? 'light' : 'dark');
      });

      // Sync if system preference changes while page is open
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function (e) {
        if (!localStorage.getItem('ac-theme')) {
          setTheme(e.matches ? 'dark' : 'light');
        }
      });
    })();
  </script>

</body>
</html>
